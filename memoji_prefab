<mxfile host="app.diagrams.net" modified="2020-10-09T04:09:02.991Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36" etag="URnwWkWdaSte0zb3AnKT" version="13.7.4" type="github">
  <diagram id="vpAl-Ta0fk0X3fxik92p" name="Page-1">
    <mxGraphModel dx="3181" dy="1963" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-19" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-1240" y="410" width="470" height="330" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-8" value="bef_effect_set_sticker_with_tag&lt;br&gt;bef_effect_api&lt;br&gt;与老引擎一致" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-480" y="20" width="200" height="70" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="y8OWoeJsC3_TyGrRz6Kq-9" target="y8OWoeJsC3_TyGrRz6Kq-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-9" value="bef_effect_init_with_resource_finder&lt;br&gt;参数：effect_handle, width, height, bef_resource_finder, deviceName&lt;br&gt;刚进拍摄页，初始化相关 xxxmanager" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="230" height="70" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="y8OWoeJsC3_TyGrRz6Kq-10" target="y8OWoeJsC3_TyGrRz6Kq-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-10" value="AmazingManager::init&lt;br&gt;参数: string&amp;amp; shareDir, string deviceName, int64 config&lt;br&gt;初始化 AmazingManager" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="150" width="230" height="70" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;shape=link;dashed=1;" edge="1" parent="1" source="y8OWoeJsC3_TyGrRz6Kq-12" target="y8OWoeJsC3_TyGrRz6Kq-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-12" value="Amazer::init&lt;br&gt;无参数&lt;br&gt;初始化所有 Amazing 相关单例" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="260" width="230" height="70" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-13" value="单例列表：&lt;br&gt;MemoryManager&lt;br&gt;&lt;b&gt;ObjectManager&lt;/b&gt;&lt;br&gt;AsyncLoader&lt;br&gt;&lt;b&gt;AssetManager&lt;/b&gt;&lt;br&gt;AssetDataBase&lt;br&gt;UniformBuiiltinName&lt;br&gt;Calibrate&lt;br&gt;Input&lt;br&gt;BuiltinObject&lt;br&gt;Profiler&lt;br&gt;EventCenter&lt;br&gt;&lt;b&gt;PrefabManager&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="670" y="150" width="130" height="200" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-18" value="AssetManager ： 基本资源管理对象，负责从二进制资源文件反序列生成 Object 实例，很多其他xxxManager 均依赖于它进行资源加载。" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-1230" y="420" width="430" height="50" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-20" value="进入拍摄页面" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="420" y="-10" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-21" value="点击道具资源包" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-425" y="-10" width="90" height="20" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="y8OWoeJsC3_TyGrRz6Kq-22" target="y8OWoeJsC3_TyGrRz6Kq-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-22" value="RenderManager::prepareEffectResV2" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-107.5" y="60" width="220" height="50" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-23" value="VE加载一帧图像, 省略前面部分诸如事件分发等内容，直接看渲染链相关" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-73.75" y="-20" width="152.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="y8OWoeJsC3_TyGrRz6Kq-24" target="y8OWoeJsC3_TyGrRz6Kq-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-24" value="BEFEffect::checkResExistOrLoaded&lt;br&gt;转&lt;br&gt;AmazingFeature::checkResExistOrLoaded&lt;br&gt;转&lt;br&gt;BaseFeature::checkResExistOrLoaded&lt;br&gt;转&lt;br&gt;AmazingFilter::checkResExistOrLoaded&lt;br&gt;转&lt;br&gt;BEFFilter::checkResExistOrloaded&lt;br&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-121.25" y="160" width="261.25" height="160" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-30" value="新引擎 AmazingFeature 资源包全流程梳理，包括资源加载，ECS构建，事件注册分发，lua回调" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-40" y="-200" width="186.25" height="70" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-31" value="AssetBase&amp;nbsp;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-890" y="-140" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-32" value="不止是新引擎AmazingFeature，每一个 feature 对应的 xxxFilter 基类 BEFFilter 负责进行该 feature 的资源加载，并通过成员 AssetBase 对象管理资源加载状态" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-910" y="30" width="170" height="100" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;" edge="1" parent="1" source="y8OWoeJsC3_TyGrRz6Kq-33" target="y8OWoeJsC3_TyGrRz6Kq-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;shape=link;" edge="1" parent="1" source="y8OWoeJsC3_TyGrRz6Kq-33" target="y8OWoeJsC3_TyGrRz6Kq-36">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-33" value="BEFFilter::checkResExistOrLoaded&lt;br&gt;检查对应 Feature 资源加载状态：&lt;br&gt;AssetBase::Status::UNLOADED 会触发资源加载行为" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-121.25" y="360" width="261.25" height="80" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-37" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="y8OWoeJsC3_TyGrRz6Kq-35" target="y8OWoeJsC3_TyGrRz6Kq-31">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-35" value="AmazingSceneAsset" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-910" y="-40" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-36" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;1. 继承自 AssetBase 的 AmazingSceneAsset 资源加载器初始化；&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;2. 将上述对象压入 AssetGroup 资源池；&lt;/span&gt;&lt;span&gt;AssetGroup 资源池拥有独立线程自行负责加载所管理的资源 AssetBase 对象；&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;3. AssetGroup 遍历资源池，调用 AssetGroup::loadContent -&amp;gt; AmazingSceneAsset::loadcontent 处理二进制 main.scene 文件，到这一步会触发同/异步加载方法从 main.scene 反序列出实例。&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;4. 反序列成功后，资源加载器存有加载后的各类 Object 对象，如 Scene/entity/component/prefab/mesh/material/png等，它们按照 ECS 的关系组织在一起，各类资源对象如 mesh/material等则挂载在对应 component(可能是父类)内，等待新的一帧被取用。&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-570" y="290" width="380" height="180" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="y8OWoeJsC3_TyGrRz6Kq-38" target="y8OWoeJsC3_TyGrRz6Kq-31">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-38" value="AssetGroup" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-730" y="-40" width="140" height="40" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-48" style="edgeStyle=orthogonalEdgeStyle;shape=link;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;" edge="1" parent="1" source="y8OWoeJsC3_TyGrRz6Kq-40" target="y8OWoeJsC3_TyGrRz6Kq-41">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-40" value="BEFFilter::checkResExistOrLoaded&lt;br&gt;检查对应 Feature 资源加载状态：&lt;br&gt;AssetBase::Status::LOADED 会触发资源取用" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-121.25" y="490" width="261.25" height="80" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-41" value="&lt;div style=&quot;text-align: left&quot;&gt;&lt;span&gt;ResourceLoaderFactory::loadResource&amp;nbsp; -&amp;gt; AmazingSceneResouceLoader::loadResource 从对应的 AmazingSceneAsset 加载器拿到已加载的 scene 对象。&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-580" y="490" width="380" height="100" as="geometry" />
        </mxCell>
        <mxCell id="y8OWoeJsC3_TyGrRz6Kq-43" value="Scene:&lt;br&gt;vector&amp;lt;Entity&amp;gt; m_entityList;&lt;br&gt;vector&amp;lt;System&amp;gt; m_systemList" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-620" y="-380" width="260" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
